<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>3J Classtream</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.26/vue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
  
  <link rel="stylesheet" href="../css/screen.css"></link>
</head>

<body>
  <div id="screen" class="screen">
    <canvas id="graph" height="350" width="600" class="graph"></canvas>
  </div>

  <script>
    var slackbot = require('slackbots');
    var fs = require('fs');

    // 設定を読み込む
    var config = fs.readFileSync('config.json', 'utf-8');
    var key = JSON.parse(config);

    var bot = new slackbot({
      token: key.token,
      name: 'classtream'
    });

    /**
      * Slackからメッセージを受け取る
      */
    bot.on('message', function (data) {
      if(data.type == "message") {
          if(data.text.indexOf(":+1:") != -1) {
              graph.add(1);
              data.text = data.text.replace(":+1:", "");
          }
          if(data.text.indexOf(":-1:") != -1) {
              graph.add(0);
              data.text = data.text.replace(":-1:", "");
          }
          if (data.text != "") {
              var element = document.createElement('p');
              element.style = "font-size: 30px";
              element.innerText = data.text;
              screen.send(element);
          }
      }
      
      console.log(data);
    });

    /**
      * Classtreamの開始メッセージを送信
      */
    bot.on('start', function () {
      var params = {
        icon_emoji: ':cat:'
      };

      bot.postMessageToChannel(key.channel, 'Start classtream !', params);
    });
  </script>

  <script src='../js/comment.js'></script>
  <script src='../js/graph.js'></script>
</body>

</html>
    
